# מדריך מעבר - מ-localStorage לשרת

## מה השתנה?

המערכת עברה משמירת נתונים ב-localStorage (בדפדפן) לשמירה בשרת. זה אומר:

✅ **יתרונות:**
- הנתונים משותפים בין כל המשתמשים
- הנתונים לא נמחקים כשמנקים את הדפדפן
- אפשר לראות מי עובד על איזה עמוד בזמן אמת
- גיבוי מרכזי של כל המידע

## מה נשמר בשרת?

### 1. סטטוס עמודים
**מיקום:** `data/pages/[שם_ספר].json`

כל ספר יש לו קובץ JSON שמכיל:
- מספר העמוד
- סטטוס (זמין / בטיפול / הושלם)
- מי תפס את העמוד
- מתי נתפס
- מתי הושלם

**דוגמה:**
```json
[
  {
    "number": 1,
    "status": "in-progress",
    "claimedBy": "יוסי כהן",
    "claimedById": "123",
    "claimedAt": "2025-11-25T10:30:00.000Z",
    "completedAt": null,
    "thumbnail": "/thumbnails/ספר/page-1.jpg"
  }
]
```

### 2. תוכן עמודים ערוכים
**מיקום:** `data/content/[שם_ספר]_page_[מספר].txt`

כל עמוד שנערך נשמר בקובץ טקסט נפרד.

**דוגמה לטור אחד:**
```
זה הטקסט שהוקלד...
```

**דוגמה לשני טורים:**
```
=== טור ימין ===
טקסט הטור הימני

=== טור שמאל ===
טקסט הטור השמאלי
```

## איך להעביר נתונים קיימים?

אם יש לך נתונים שמורים ב-localStorage מהגרסה הקודמת:

1. פתח את האתר בדפדפן
2. פתח את ה-Console (לחץ F12)
3. העתק והדבק את הקוד מ-`scripts/migrate-localstorage.js`
4. לחץ Enter
5. עקוב אחרי ההוראות על המסך

הסקריפט יעביר אוטומטית את כל הנתונים לשרת וימחק את ה-localStorage הישן.

## API Endpoints

### קבלת מידע על ספר
```
GET /api/book/[bookPath]
```
מחזיר את פרטי הספר וסטטוס כל העמודים.

### תפיסת עמוד
```
POST /api/book/[bookPath]
Body: {
  "action": "claim",
  "bookPath": "...",
  "pageNumber": 5,
  "userId": "123",
  "userName": "יוסי"
}
```

### סימון עמוד כהושלם
```
POST /api/book/[bookPath]
Body: {
  "action": "complete",
  "bookPath": "...",
  "pageNumber": 5,
  "userId": "123"
}
```

### שמירת תוכן עמוד
```
POST /api/page-content
Body: {
  "bookPath": "...",
  "pageNumber": 5,
  "content": "...",
  "leftColumn": "...",
  "rightColumn": "...",
  "twoColumns": false
}
```

### קריאת תוכן עמוד
```
GET /api/page-content?bookPath=...&pageNumber=5
```

## פתרון בעיות

### הנתונים לא מתעדכנים
- רענן את הדף (F5)
- בדוק שאתה מחובר למערכת
- בדוק את ה-Console לשגיאות

### עמוד תקוע ב"בטיפול"
אם משתמש תפס עמוד ולא סיים, אדמין יכול לערוך ידנית את הקובץ:
```
data/pages/[שם_ספר].json
```
ולשנות את הסטטוס בחזרה ל-`"available"`.

### תוכן נעלם
כל התוכן נשמר ב-`data/content/`. אם משהו נעלם, בדוק שם.

## גיבוי

מומלץ לגבות את התיקייה `data/` באופן קבוע:
```bash
# Windows
xcopy /E /I data data_backup_%date%

# Linux/Mac
cp -r data data_backup_$(date +%Y%m%d)
```

## שאלות נפוצות

**ש: האם הנתונים הישנים ב-localStorage נמחקים אוטומטית?**
ת: לא, הם נשארים עד שתריץ את סקריפט ההעברה או תנקה אותם ידנית.

**ש: מה קורה אם שני משתמשים מנסים לתפוס את אותו עמוד?**
ת: המשתמש הראשון יצליח, והשני יקבל הודעת שגיאה.

**ש: האם אפשר לעבוד אופליין?**
ת: לא, המערכת החדשה דורשת חיבור לשרת. זה מבטיח שכולם רואים את אותו מצב.
